<div class="table-card">

  <div class="page-header">

  <div class="page-header-left">
    <h2 class="page-title">Products Management</h2>    
  </div>

</div>

  <div class="analytics-cards">

  <div class="card">
    <h3>Total Products</h3>
    <p>{{ totalProducts }}</p>
  </div>

  <div class="card">
    <h3>Total Categories</h3>
    <p>{{ categories.length }}</p>
  </div>

  <div class="card">
    <h3>Latest Product</h3>
    <p>{{ products[0]?.name }}</p>
  </div>

</div>

<div class="filter-container">

  <!-- SEARCH FIELD -->
  <mat-form-field appearance="outline" class="search-field">

    <mat-label>Search Product</mat-label>

    <mat-icon matPrefix>search</mat-icon>

    <input
      matInput
      [(ngModel)]="searchTerm"
      (keyup)="onSearchChange(searchTerm)"
      placeholder="Search by name..."
    />

    <button
      *ngIf="searchTerm"
      mat-icon-button
      matSuffix
      (click)="clearSearch()">
      <mat-icon>close</mat-icon>
    </button>

  </mat-form-field>


  <!-- CATEGORY FIELD -->
  <mat-form-field appearance="outline" class="category-field">
    <mat-label>Filter by Category</mat-label>

    <mat-select
      [(value)]="selectedCategory"
      (selectionChange)="onCategoryChange($event.value)">

      <mat-option value="">
        All Categories
      </mat-option>

      <mat-option
        *ngFor="let cat of categories"
        [value]="cat.id">

        {{ cat.name }} 
      </mat-option>

    </mat-select>
  </mat-form-field>

</div>

<div class="bulk-actions">
  <button
    class="bulk-restock-btn"
    (click)="bulkRestockLowStock()">
    ðŸ“¦ Restock All Low Stock
  </button>
</div>


  <div class="products-wrapper">

    <table class="products-table">

      <thead>
        <tr>
          <th class="col-name">Name</th>
          <th class="col-price">Price</th>
          <th class="col-category">Category</th>
          <th class="col-quantity">Quantity</th>
          <th class="col-stockquantity">Stock Quantity</th>
          <th class="col-action">Action</th>
        </tr>
      </thead>

      <tbody>

        <tr *ngFor="let product of products">

          <td class="col-name">{{ product.name }}</td>

          <td class="col-price">â‚¹{{ product.price }}</td>

          <td class="col-category">{{ categoryMap[product.categoryId] }}</td>

          <td class="col-quantity">{{ product.quantity }}</td>

          
      <!-- STOCK COLUMN -->
      
        <td>
  <div class="stock-cell">

    <span class="stock-value"
          [class.out-stock]="product.stockQuantity === 0">
      {{ getFormattedStock(product) }}
    </span>

    <button *ngIf="shouldReorder(product)"
            class="reorder-btn"
            (click)="restockProduct(product)">
      ðŸ”„ Re-order {{ getReorderQuantity(product) }}
    </button>

  </div>
</td>

          <td class="col-action">
            <div class="action-icons">

              <button class="icon-btn edit-icon"
                      (click)="editProduct(product)">
                <mat-icon>edit</mat-icon>
              </button>

              <button class="icon-btn delete-icon"
                      (click)="deleteProduct(product.id!)">
                <mat-icon>delete</mat-icon>
              </button>

            </div>
          </td>

        </tr>

        <tr *ngIf="products.length === 0 && !loading">
          <td colspan="5" style="text-align:center; padding:20px;">
            No products found.
          </td>
        </tr>       

      </tbody>

    </table>
    
    <div class="table-footer">

  <div class="items-per-page">
    <label>Items per page</label>
    <select [(ngModel)]="pageSize" (change)="onPageSizeChange()">
      <option [value]="10">10</option>
      <option [value]="20">20</option>
      <option [value]="50">50</option>
      <option [value]="100">100</option>
    </select>
  </div>

  <div class="pagination-info">
1â€“{{ products.length }} of {{ totalProducts }}
  </div>

</div>
  </div>

</div>
